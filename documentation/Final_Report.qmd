---
title: Did China Drive Its Own Image Problem? Analyzing Events and Filipino Public Opinion
author: Zach Einolf
date: 17 December 2025
embed-resources: true
editor: visual
execute:
  warning: false
  message: false
  error: false
  tidy: true
format:
  html:
    embed-resources: false
    quarto-html: true
theme: darkly
toc: true
toc-depth: 2
---

```{r, include=FALSE}
library(readr)
library(dplyr)
library(tidyverse)
library(cluster)
library(factoextra)
library(ggplot2)
library(haven)
library(doBy)
library(tidyr)
library(acled.api)
library(httr)
library(httr2)
library(purrr)
library(xml2)
library(httr)
library(httr2)
library(readr)
library(stringr)
library(DBI)
library(RSQLite)
library(scales)
library(fastDummies)
library(shiny)
library(rlang)
library(bslib)
```

```{r}
con <- dbConnect(SQLite(), "../data/acled_data.db")
acled_data <- dbReadTable(con, "acled_data.db")
dbDisconnect(con)

acled_data_c<- acled_data|> 
  mutate(
  event_date = ymd(event_date),
  month = as.Date(month))|>
  filter(event_type %in% c("protests", "strategic developments"))

acled_data_c |>
  count(month, event_type, name = "n_events") |>
  complete(month, event_type, fill = list(n_events = 0))|>
  ggplot(aes(x = month, y = n_events, color = event_type)) +
  geom_line() +
  geom_point() +
  scale_x_date(date_breaks = "5 months", date_labels = "%b %Y") +
  labs(
    title = "ACLED Events Involving China/Philippines Government and Civilian Hostility",
    x = "Month",
    y = "Number of Events",
    color = "Event Type"
    ) +
  theme_minimal(base_size = 13) +
  theme(
    panel.background  = element_rect(fill = "black", color = NA),
    plot.background   = element_rect(fill = "black", color = NA),
    legend.background = element_rect(fill = "black", color = NA),
    panel.grid.major  = element_line(color = "grey20"),
    panel.grid.minor  = element_blank(),
    axis.text         = element_text(color = "white"),
    axis.title        = element_text(color = "white"),
    legend.text       = element_text(color = "white"),
    legend.title      = element_text(color = "white"),
    strip.text        = element_text(color = "white"),
    plot.title        = element_text(color = "white", face = "bold", size = 10, hjust = 0.5),
    plot.subtitle     = element_text(color = "white", size = 8, hjust = 0.5),
    axis.text.x       = element_text(angle = 45, hjust = 1)
  )

#ggsave("../visualizations/acled_event_time.png")
```

```{r}
con <- dbConnect(SQLite(), "../data/asia_final_cluster.db")
asia_final_cluster <- dbReadTable(con, "asia_final_cluster.db")
dbDisconnect(con)

attitude_vars <- c(
  "asia_influence",
  "china_harm",
  "asia_future_inf",
  "model_development",
  "china_deg_inf",
  "china_inf_op",
  "china_dem"
)

#defining
demo_vars <- c(
  "locality_level",
  "education",
  "age",
  "gender",
  "region"
)

#defining
all_vars <- c(demo_vars, attitude_vars)

cluster_profiles_wave <- asia_final_cluster |>
  filter(!is.na(cluster)) |>
  mutate(
    wave_label = factor(
      wave,
      levels = c(3,4, 5, 6),
      labels = c("Wave 3 (2010)", "Wave 4 (2014)", "Wave 5 (2018)", "Wave 6 (2021)")
    )
  ) |>
  group_by(wave_label, cluster) |>
  summarize(
    across(all_of(attitude_vars), ~ mean(.x, na.rm = TRUE)),
    .groups = "drop"
  ) |>
  pivot_longer(
    cols = all_of(attitude_vars),
    names_to = "variable",
    values_to = "mean_val"
  )

ggplot(
  cluster_profiles_wave,
  aes(x = variable, y = mean_val, group = cluster, color = cluster)
) +
  geom_line() +
  geom_point() +
  coord_polar() +
  facet_wrap(~ wave_label, nrow = 3) +
  labs(
    title = "Cluster Profiles Across China-Related Attitudes by Wave",
    x = "",
    y = "Mean (original scale)",
    color = "Cluster"
  ) +
  theme_minimal(base_size = 11) +
  theme(
    panel.background  = element_rect(fill = "black", color = NA),
    plot.background   = element_rect(fill = "black", color = NA),
    legend.background = element_rect(fill = "black", color = NA),
    panel.grid.major  = element_line(color = "grey20"),
    panel.grid.minor  = element_blank(),
    axis.text         = element_text(color = "white"),
    axis.title        = element_text(color = "white"),
    legend.text       = element_text(color = "white"),
    legend.title      = element_text(color = "white"),
    strip.text        = element_text(color = "white"),
    plot.title        = element_text(color = "white", face = "bold", size = 13, hjust = 0.5),
    plot.subtitle     = element_text(color = "white", size = 13, hjust = 0.5),
    axis.text.x       = element_text(size = 5, angle = 45, hjust = 1),
    plot.margin = margin(40, 40, 40, 40),
    panel.spacing = unit(2, "cm")
  )+
  coord_polar(clip = "off")

#ggsave("../visualizations/attitude_radar.png")
```

```{r}
con <- dbConnect(SQLite(), "../data/pca_combined.db") 
pca_combined<- dbReadTable(con, "pca_combined.db") 
dbDisconnect(con)


cor_PC_att <- pca_combined |>
  select(PC1, PC2, all_of(attitude_vars)) |>
  cor(use = "pairwise.complete.obs")

cor_PC_att_df <- as.data.frame(cor_PC_att) |>
  rownames_to_column("row_var") |>
  pivot_longer(
    cols = -row_var,
    names_to = "col_var",
    values_to = "correlation"
  )

ggplot(cor_PC_att_df, aes(x = col_var, y = row_var, fill = correlation)) +
  geom_tile() +
  scale_fill_gradient2(limits = c(-1, 1)) +
  labs(
    title = "Correlation of PCs with Attitude Variables",
    x = "",
    y = "",
    fill = "r"
  ) +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
ggplot(pca_combined, aes(x = PC1, y = PC2, color = cluster, shape = wave)) +
  geom_point(alpha = 0.7) +
  labs(
    title = "PCA of China-Related Attitudes Colored by Cluster",
    x = "PC1",
    y = "PC2",
    color = "Cluster",
    shape = "Wave"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    panel.background  = element_rect(fill = "black", color = NA),
    plot.background   = element_rect(fill = "black", color = NA),
    legend.background = element_rect(fill = "black", color = NA),
    panel.grid.major  = element_line(color = "grey20"),
    panel.grid.minor  = element_blank(),
    axis.text         = element_text(color = "white"),
    axis.title        = element_text(color = "white"),
    legend.text       = element_text(color = "white"),
    legend.title      = element_text(color = "white"),
    strip.text        = element_text(color = "white"),
    plot.title        = element_text(color = "white", face = "bold", size = 13, hjust = 0.5),
    plot.subtitle     = element_text(color = "white", size = 13, hjust = 0.5),
    axis.text.x       = element_text(angle = 45)
  ) +
  guides(
    shape = guide_legend(override.aes = list(color = "white", fill = "white"))
  )
```

```{r}
ggplot(pca_combined, aes(x = region, y = PC1)) +
  stat_summary(fun = mean, geom = "point") +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width = 0.2) +
  labs(
    title = "Mean PC1 by Region (with 95% CI)",
    x = "Region",
    y = "Mean PC1"
  ) +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

<iframe src="https://zeinolf.shinyapps.io/gvpt628_finalproject/" width="145%" height="900px" style="border:none;">

</iframe>
